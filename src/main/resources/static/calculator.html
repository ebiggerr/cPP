<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
<link rel="stylesheet" href="css/stylesheet.css">
<script src="https://code.jquery.com/jquery-1.12.3.min.js"></script>
<body>

<!-- Navbar -->
<div class="w3-top">
    <div class="w3-bar w3-white w3-padding w3-card" style="letter-spacing:4px;">
    <a href="index.html" class="w3-bar-item w3-button">Online Car Reseller Platform</a>
        <div class="w3-right w3-hide-small">
            <a href="login.html" class="w3-bar-item w3-button">Log-In</a>
            <a href="register.html" class="w3-bar-item w3-button">Register</a>
            <a href="sales.html" class="w3-bar-item w3-button">Sales</a>
        </div>
    </div>
</div>

<center>
    <div style="margin-top: 4%;">
        <table style="width:80%">
            <tr>
                <td colspan="8"><hr></td>
            </tr>

            <tr>
                <td><label>Car ID </label></td>
                <td><input type="text" id="car_ID" name="car_ID" disabled></td>

                <td><label>Car Brand </label></td>
                <td><input type="text" id="CarBrand" name="CarBrand" style="width: 18em" value="alfa-romeo"></td>

                <td><label>Car Model </label></td>
                <td><input type="text" id="CarName" name="CarName" style="width: 18em" value="giulia"></td>

                <td><label>Symboling </label></td>
                <td><input type="text" id="symboling" name="symboling" value="3"></td>
            </tr>

            <tr>
                <td colspan="8"><hr></td>
            </tr>

            <tr>
                <td><label>Car Body </label></td>
                <td>
                    <select id="carbody" name="carbody">
                        <option value="null" disabled >-- SELECT --</option>
                        <option value="sedan">Sedan</option>
                        <option value="hatchback">Hatchback</option>
                        <option value="convertible" selected>Convertible</option>
                        <option value="wagon">Wagon</option>
                    </select>
                </td>

                <td><label>Door Numbers</label></td>
                <td>
                    <select id="doornumber" name="doornumber">
                        <option value="null" disabled>-- SELECT --</option>
                        <option value="two" selected>Two</option>
                        <option value="four">Four</option>
                    </select>
                </td>

                <td><label>Curbweight (kg)</label></td>
                <td><input type="text" id="curbweight" name="curbweight" value="2548"></td>

                <td><label>Wheelbase </label></td>
                <td><input type="text" id="wheelbase" name="wheelbase" value="88.6"></td>
            </tr>

            <tr>
                <td><label>Car Length </label></td>
                <td><input type="text" id="carlength" name="carlength" value="168.8"></td>

                <td><label>Car Width </label></td>
                <td><input type="text" id="carwidth" name="carwidth" value="64.1"></td>

                <td><label>Car Height </label></td>
                <td><input type="text" id="carheight" name="carheight" value="48.8"></td>
            </tr>

            <tr>
                <td colspan="8"><hr></td>
            </tr>

            <tr>
                <td><label>Engine Type </label></td>
                <td>
                    <select id="enginetype" name="enginetype">
                        <option value="null" disabled>-- SELECT --</option>
                        <option value="dohc" selected>DOHC</option>
                        <option value="dohcv">DOHCV</option>
                        <option value="ohc">OHC</option>
                        <option value="ohcf">OHCF</option>
                        <option value="ohcv">OHCV</option>
                        <option value="rotor">Rotary</option>
                        <option value="l">L</option>
                    </select>
                </td>

                <td><label>Cylinder Number </label></td>
                <td>
                    <select id="cylindernumber" name="cylindernumber">
                        <option value="null" disabled>-- SELECT --</option>
                        <option value="four" selected>Four</option>
                        <option value="six">Six</option>
                        <option value="eight">Eight</option>
                    </select>
                </td>

                <td><label>Fuel Type </label></td>
                <td>
                    <select id="fueltype" name="fueltype">
                        <option value="null" disabled >-- SELECT --</option>
                        <option value="gas" selected>Gas</option>
                        <option value="diesel">Diesel</option>
                    </select>
                </td>

                <td><label>Aspiration </label></td>
                <td>
                    <select id="aspiration" name="aspiration">
                        <option value="null" disabled >-- SELECT --</option>
                        <option value="std" selected>Standard</option>
                        <option value="turbo">Turbo</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td><label>Engine Size </label></td>
                <td><input type="text" id="enginesize" name="enginesize" value="110"></td>

                <td><label>Engine Location </label></td>
                <td>
                    <select id="enginelocation" name="enginelocation">
                        <option value="null" disabled >-- SELECT --</option>
                        <option value="front" selected>Front</option>
                        <option value="rear">Rear</option>
                    </select>
                </td>

                <td><label>Fuel System</label></td>
                <td>
                    <select id="fuelsystem" name="fuelsystem">
                        <option value="null" disabled >-- SELECT --</option>
                        <option value="mfi">Multi-Port Fuel Injection (MFI)</option>
                        <option value="mpfi" selected>Multi-Point Fuel Injection (MPFI)</option>
                        <option value="spfi">Spark Plug Fuel Injection (SPFI)</option>
                        <option value="idi">Indirect Injection (IDI)</option>
                        <option value="1bbl">1BBL</option>
                        <option value="2bbl">2BBL</option>
                    </select>
                </td>

                <td><label>Drivewheel </label></td>
                <td>
                    <select id="drivewheel" name="drivewheel">
                        <option value="null" disabled >-- SELECT --</option>
                        <option value="fwd">Front-Wheel Drive</option>
                        <option value="rwd" selected>Rear-Wheel Drive</option>
                        <option value="4wd">Four-Wheel Drive</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td><label>Bore Ratio </label></td>
                <td><input type="text" id="boreratio" name="boreratio" value="3.47"></td>

                <td><label>Stroke </label></td>
                <td><input type="text" id="stroke" name="stroke" value="2.68"></td>

                <td><label>Compression Ratio</label></td>
                <td><input type="text" id="compressionratio" name="compressionratio" value="9"></td>
            </tr>

            <tr>
                <td><label>Horsepower </label></td>
                <td><input type="text" id="horsepower" name="horsepower" value="111"></td>

                <td><label>Peak RPM </label></td>
                <td><input type="text" id="peakrpm" name="peakrpm" value="5000"></td>

                <td><label>City Miles per Gallon (mpg) </label></td>
                <td><input type="text" id="citympg" name="citympg" value="21"></td>

                <td><label>Highway Miles per Gallon (mpg) </label></td>
                <td><input type="text" id="highwaympg" name="highwaympg" value="27"></td>
            </tr>

            <tr>
                <td colspan="8"><hr></td>
            </tr>

            <tr>
                <td colspan="8"><input type="submit" value="Calculate" id="submit" style="width: 120em; height: 40px"></td>
            </tr>

            <tr>
                <td colspan="8"><hr></td>
            </tr>
        </table>
        <div class="loading" id="loading" style="display: none;"></div>
        <div id="displayDiv" style="display: none;">
            <h2><b>Calculated Price</b></h2>
            Based on the information given, the system has predicted that the resale value of your vehicle is:
            <h3><div id="outputPrediction"></div></h3>
            <br>
            <h2><b>Adjust your pricing</b></h2>
            <input type="range" min="1000" max="80000" value="10000" class="slider" id="quotedPriceRange" name="quotedPriceRange">
            <h3>US$ <span id="quotedPrice"></span></h3>
        </div>
    </div>
</center>
<script>
    var slider = document.getElementById("quotedPriceRange");
    var output = document.getElementById("quotedPrice");
    var iteration = 10;
    document.getElementById("car_ID").value = iteration;

    slider.oninput = function () {
        output.innerHTML = this.value;
    }

    jQuery(document).ready(function($) {
        $('#submit').click(function() {
            $('#displayDiv').hide();
            var carData = {};
            var newIteration = iteration++;
            document.getElementById("car_ID").value = newIteration;
            //carData["car_ID"] = $('#car_ID').val();
            carData["car_ID"] = newIteration;
            carData["symboling"] = $('#symboling').val();
            carData["carName"] = $('#CarBrand').val() + " " +$('#CarName').val();
            carData["fueltype"] = $('#fueltype').val();
            carData["aspiration"] = $('#aspiration').val();
            carData["doornumber"] = $('#doornumber').val();
            carData["carbody"] = $('#carbody').val();
            carData["drivewheel"] = $('#drivewheel').val();
            carData["enginelocation"] = $('#enginelocation').val();
            carData["wheelbase"] = $('#wheelbase').val();
            carData["carlength"] = $('#carlength').val();
            carData["carwidth"] = $('#carwidth').val();
            carData["carheight"] = $('#carheight').val();
            carData["curbweight"] = $('#curbweight').val();
            carData["enginetype"] = $('#enginetype').val();
            carData["cylindernumber"] = $('#cylindernumber').val();
            carData["enginesize"] = $('#enginesize').val();
            carData["fuelsystem"] = $('#fuelsystem').val();
            carData["boreratio"] = $('#boreratio').val();
            carData["stroke"] = $('#stroke').val();
            carData["compressionratio"] = $('#compressionratio').val();
            carData["horsepower"] = $('#horsepower').val();
            carData["peakrpm"] = $('#peakrpm').val();
            carData["citympg"] = $('#citympg').val();
            carData["highwaympg"] = $('#highwaympg').val();

            console.log(carData);
            var rand = Math.round(Math.random() * (2000 - 500)) + 500;

            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: "/api/v1/prediction",
                data: JSON.stringify(carData),
                dataType: 'json',
                success: function(data) {
                    console.log(JSON.stringify(data));
                    const jsonData = JSON.stringify(data.predictedPrice);
                    var suggestedPrice = parseFloat(jsonData.replace(/\"/g, ""));
                    const maxSuggestedPrice = Math.ceil(suggestedPrice) + 2500;
                    const minSuggestedPrice = Math.floor(suggestedPrice) - 2500;
                    $('#outputPrediction').html("US$").append(jsonData.replace(/\"/g, ""));
                    $('#loading').show();
                    setTimeout(function () {
                        $('#loading').hide();
                        $('#displayDiv').slideUp( 300 ).fadeIn( 400 );
                        slider.min = minSuggestedPrice;
                        slider.max = maxSuggestedPrice;
                        slider.value = suggestedPrice;
                        output.innerHTML = suggestedPrice;
                    }, rand);
                }
            })
        })
    })
</script>
</body>
</div>
</html>